Part 0: Preparation
--Step 1
SQL> startup pfile=/home/oracle/cit487/disk1/admin/pfile/initcit487.ora
ORACLE instance started.

Total System Global Area 1073741824 bytes
Fixed Size		    2932632 bytes
Variable Size		  671088744 bytes
Database Buffers	  394264576 bytes
Redo Buffers		    5455872 bytes
Database mounted.
Database opened.
SQL> connect system/manager
Connected.
SQL> @/home/oracle/Downloads/Lab-5-files/dept.sql
DROP TABLE DEPT CASCADE CONSTRAINTS
           *
ERROR at line 1:
ORA-00942: table or view does not exist



Table created.

SQL> @/home/oracle/Downloads/Lab-5-files/deptdata.sql

1 row created.


1 row created.


1 row created.


1 row created.


Commit complete.

SQL> @/home/oracle/Downloads/Lab-5-files/emp.sql
DROP TABLE EMP CASCADE CONSTRAINTS
           *
ERROR at line 1:
ORA-00942: table or view does not exist



Table created.

SQL> @/home/oracle/Downloads/Lab-5-files/empdata.sql

1 row created.


1 row created.


1 row created.


1 row created.


1 row created.


1 row created.


1 row created.


1 row created.


1 row created.


1 row created.


1 row created.


1 row created.


1 row created.


1 row created.


Commit complete.

SQL> 

Part 1: Backing Up
--Step 1
[oracle@bigdatalite ~]$ find /home/oracle/cit487/ -name "init*.ora"
/home/oracle/cit487/disk1/admin/pfile/initcit487.ora
[oracle@bigdatalite ~]$ sqlplus / as sysdba

SQL*Plus: Release 12.1.0.2.0 Production on Mon Nov 18 16:55:54 2024

Copyright (c) 1982, 2014, Oracle.  All rights reserved.


Connected to:
Oracle Database 12c Enterprise Edition Release 12.1.0.2.0 - 64bit Production
With the Partitioning, OLAP, Advanced Analytics and Real Application Testing options

SQL> select name from v$controlfile;

NAME
--------------------------------------------------------------------------------
/home/oracle/cit487/disk1/oradata/control01.ctl
/home/oracle/cit487/disk1/oradata/control02.ctl
/home/oracle/cit487/disk1/oradata/control03.ctl

SQL> select name from v$datafile;

NAME
--------------------------------------------------------------------------------
/home/oracle/cit487/disk1/oradata/system01.dbf
/home/oracle/cit487/disk1/oradata/system02.dbf
/home/oracle/cit487/disk10/oradata/undotbs1.dbf
/home/oracle/cit487/disk8/oradata/user01.dbf
/home/oracle/cit487/disk7/oradata/appl01.dbf

SQL> select member from v$logfile;

MEMBER
--------------------------------------------------------------------------------
/home/oracle/cit487/disk2/oradata/log1a.rdo
/home/oracle/cit487/disk3/oradata/log1b.rdo
/home/oracle/cit487/disk3/oradata/log2a.rdo
/home/oracle/cit487/disk4/oradata/log2b.rdo
/home/oracle/cit487/disk4/oradata/log3a.rdo
/home/oracle/cit487/disk2/oradata/log3b.rdo

6 rows selected.

SQL> 

--Step 2
SQL> shutdown normal
Database closed.
Database dismounted.
ORACLE instance shut down.
SQL> exit 
Disconnected from Oracle Database 12c Enterprise Edition Release 12.1.0.2.0 - 64bit Production
With the Partitioning, OLAP, Advanced Analytics and Real Application Testing options
[oracle@bigdatalite ~]$ 

--Step 3
[oracle@bigdatalite ~]$ ps -ef | grep oracle
oracle    65804  63895  0 16:58 pts/0    00:00:00 ps -ef
oracle    65805  63895  0 16:58 pts/0    00:00:00 grep oracle
[oracle@bigdatalite ~]$ 

--Step 4
[oracle@bigdatalite ~]$ mkdir backup
[oracle@bigdatalite ~]$ cp -r /home/oracle/cit487/. /home/oracle/backup/.
[oracle@bigdatalite ~]$ ls backup/
disk1  disk10  disk2  disk3  disk4  disk5  disk6  disk7  disk8  disk9
[oracle@bigdatalite ~]$ 

--Step 5
db_name='cit487'
memory_target=1G
processes = 150
audit_file_dest='/cit487/disk1/admin/adump'
audit_trail ='db'
db_block_size=8192
db_domain=''
db_recovery_file_dest='/cit487/disk1/flash_recovery_area'
db_recovery_file_dest_size=2G
diagnostic_dest='/cit487/disk1/'
dispatchers='(PROTOCOL=TCP) (SERVICE=ORCLXDB)'
open_cursors=300 
remote_login_passwordfile='EXCLUSIVE'
undo_tablespace='UNDOTBS1'
LOG_ARCHIVE_DEST_1='location=/home/oracle/cit487/disk10/archive'
LOG_ARCHIVE_FORMAT=CIT487_%t_%s_%r.AR

--Step 6
[oracle@bigdatalite ~]$ sqlplus / as sysdba

SQL*Plus: Release 12.1.0.2.0 Production on Mon Nov 18 22:51:52 2024

Copyright (c) 1982, 2014, Oracle.  All rights reserved.

Connected to an idle instance.

SQL> startup pfile=/home/oracle/backup/disk1/admin/pfile/initcit487.ora MOUNT
ORACLE instance started.

Total System Global Area 1073741824 bytes
Fixed Size		    2932632 bytes
Variable Size		  671088744 bytes
Database Buffers	  394264576 bytes
Redo Buffers		    5455872 bytes
Database mounted.

SQL> alter database archivelog;

Database altered.

SQL> archive log start;
Statement processed.
SQL> alter database open;

Database altered.

SQL> archive log list
Database log mode	       Archive Mode
Automatic archival	       Enabled
Archive destination	       /home/oracle/cit487/disk10/archive
Oldest online log sequence     1620
Next log sequence to archive   1622
Current log sequence	       1622
SQL> 

--Step 7
SQL> connect system/manager
Connected.
SQL> alter table emp disable primary key;

Table altered.

SQL> insert into emp select * from emp;

14 rows created.

SQL> insert into emp select * from emp;

28 rows created.

SQL> insert into emp select * from emp;

56 rows created.

SQL> insert into emp select * from emp;

112 rows created.

SQL> 

--Step 8
SQL> connect /as sysdba
Connected.
SQL> alter system switch logfile;

System altered.

SQL> connect system/manager
Connected.
SQL> insert into emp select * from emp;

224 rows created.

SQL> insert into emp select * from emp;

448 rows created.

SQL> insert into emp select * from emp;

896 rows created.

SQL> connect / as sysdba
Connected.
SQL> alter system switch logfile;

System altered.

SQL> connect system/manager
Connected.
SQL> insert into emp select * from emp;

1792 rows created.

SQL> insert into emp select * from emp;

3584 rows created.

SQL> insert into emp select * from emp;

7168 rows created.

SQL> connect / as sysdba
Connected.
SQL> alter system switch logfile;

System altered.

SQL> exit
Disconnected from Oracle Database 12c Enterprise Edition Release 12.1.0.2.0 - 64bit Production
With the Partitioning, OLAP, Advanced Analytics and Real Application Testing options
[oracle@bigdatalite ~]$ 

--Step 9
[oracle@bigdatalite ~]$ ls /home/oracle/cit487/disk10/archive/
CIT487_1_1621_1180465590.ARC  CIT487_1_1631_1180465590.ARC
CIT487_1_1622_1180465590.ARC  CIT487_1_1632_1180465590.ARC
CIT487_1_1623_1180465590.ARC  CIT487_1_1633_1180465590.ARC
CIT487_1_1624_1180465590.ARC  CIT487_1_1634_1180465590.ARC
CIT487_1_1625_1180465590.ARC  CIT487_1_1635_1180465590.ARC
CIT487_1_1626_1180465590.ARC  CIT487_1_1636_1180465590.ARC
CIT487_1_1627_1180465590.ARC  CIT487_1_1637_1180465590.ARC
CIT487_1_1628_1180465590.ARC  CIT487_1_1638_1180465590.ARC
CIT487_1_1629_1180465590.ARC  CIT487_1_1639_1180465590.ARC
CIT487_1_1630_1180465590.ARC  CIT487_1_1640_1180465590.ARC
[oracle@bigdatalite ~]$ 

--Step 10
[oracle@bigdatalite ~]$ sqlplus / as sysdba

SQL*Plus: Release 12.1.0.2.0 Production on Mon Nov 18 23:01:55 2024

Copyright (c) 1982, 2014, Oracle.  All rights reserved.


Connected to:
Oracle Database 12c Enterprise Edition Release 12.1.0.2.0 - 64bit Production
With the Partitioning, OLAP, Advanced Analytics and Real Application Testing options

SQL> archive log list
Database log mode	       Archive Mode
Automatic archival	       Enabled
Archive destination	       /home/oracle/cit487/disk10/archive
Oldest online log sequence     1639
Next log sequence to archive   1641
Current log sequence	       1641
SQL> 

--Step 11
SQL> shutdown immediate
Database closed.
Database dismounted.
ORACLE instance shut down.
SQL> exit
Disconnected from Oracle Database 12c Enterprise Edition Release 12.1.0.2.0 - 64bit Production
With the Partitioning, OLAP, Advanced Analytics and Real Application Testing options
[oracle@bigdatalite ~]$ 

--Step 12
[oracle@bigdatalite ~]$ ps -ef | grep oracle
oracle    72735  72057  0 23:06 pts/0    00:00:00 ps -ef
oracle    72736  72057  0 23:06 pts/0    00:00:00 grep oracle
[oracle@bigdatalite ~]$ 

Part 2: Simulate Scenario for Recovery
--Step 13
[oracle@bigdatalite ~]$ mv /home/oracle/cit487/disk7/oradata/appl01.dbf .

--Step 14
[oracle@bigdatalite ~]$ sqlplus / as sysdba

SQL*Plus: Release 12.1.0.2.0 Production on Mon Nov 18 23:10:13 2024

Copyright (c) 1982, 2014, Oracle.  All rights reserved.

Connected to an idle instance.

SQL> startup pfile=/home/oracle/cit487/disk1/admin/pfile/initcit487.ora
ORACLE instance started.

Total System Global Area 1073741824 bytes
Fixed Size		    2932632 bytes
Variable Size		  671088744 bytes
Database Buffers	  394264576 bytes
Redo Buffers		    5455872 bytes
Database mounted.
ORA-01157: cannot identify/lock data file 5 - see DBWR trace file
ORA-01110: data file 5: '/home/oracle/cit487/disk7/oradata/appl01.dbf'


SQL> 

Part 3: Recover the Database
--Step 15
SQL> shutdown 
ORA-01109: database not open


Database dismounted.
ORACLE instance shut down.
SQL> exit
Disconnected from Oracle Database 12c Enterprise Edition Release 12.1.0.2.0 - 64bit Production
With the Partitioning, OLAP, Advanced Analytics and Real Application Testing options
[oracle@bigdatalite ~]$ mv /home/oracle/backup/disk7/oradata/appl01.dbf /home/oracle/cit487/disk7/oradata/appl01.dbf
[oracle@bigdatalite ~]$ sudo chown oracle:dba /home/oracle/cit487/disk7/oradata/appl01.dbf
[oracle@bigdatalite ~]$ 

--Step 16
[oracle@bigdatalite ~]$ sqlplus / as sysdba

SQL*Plus: Release 12.1.0.2.0 Production on Tue Nov 19 00:33:42 2024

Copyright (c) 1982, 2014, Oracle.  All rights reserved.

Connected to an idle instance.

SQL> startup pfile=/home/oracle/backup/disk1/admin/pfile/initcit487.ora MOUNT
ORACLE instance started.

Total System Global Area 1073741824 bytes
Fixed Size		    2932632 bytes
Variable Size		  671088744 bytes
Database Buffers	  394264576 bytes
Redo Buffers		    5455872 bytes
Database mounted.
SQL> alter database archivelog;

Database altered.

SQL> archive log start;
Statement processed.
SQL> alter database recover automatic;

Database altered.

SQL> alter database open;

Database altered.

SQL> archive log list
Database log mode	       Archive Mode
Automatic archival	       Enabled
Archive destination	       /home/oracle/cit487/disk10/archive
Oldest online log sequence     1639
Next log sequence to archive   1641
Current log sequence	       1641
SQL> select status from dba_tablespaces where tablespace_name='APPL_DATA';

STATUS
---------
ONLINE

SQL>

--Step 17
SQL> connect system/manager
Connected.
SQL> select count(*) from emp;

  COUNT(*)
----------
     14336

SQL> 



